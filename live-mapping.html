<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">

<head>
    <!-- Google fonts! -->
    <link href='http://fonts.googleapis.com/css?family=Bitter:400,700,400italic|Patua+One' rel='stylesheet' type='text/css'>

    <title>Live mapping - justmytwospence</title>
    
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link href="http://spencerboucher.com//favicon.ico" rel="icon">

    <!-- Open Graph tags -->
        <meta property="og:site_name" content="justmytwospence" />
            <meta property="og:type" content="article"/>
            <meta property="og:title" content="Live mapping"/>
            <meta property="og:url" content="http://spencerboucher.com/live-mapping.html"/>
            <meta property="og:description" content="Let&#39;s put on our quantified-self hats and find out where we spend our time!"/>
            <meta property="article:published_time" content="2014-01-08" />
            <meta property="article:section" content="Vizualization" />
            <meta property="article:tag" content="api" />
            <meta property="article:tag" content="aws" />
            <meta property="article:tag" content="cartoDB" />
            <meta property="article:tag" content="cartography" />
            <meta property="article:tag" content="cron" />
            <meta property="article:tag" content="ec2" />
            <meta property="article:tag" content="map" />
            <meta property="article:tag" content="quantifiedSelf" />

    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://spencerboucher.com/theme/css/bootstrap.solarizedlight.min.css" type="text/css"/>
    <link href="http://spencerboucher.com/theme/css/font-awesome.min.css" rel="stylesheet">
    <link href="http://spencerboucher.com/theme/css/pygments/solarizeddark.css" rel="stylesheet">
        <link href="http://spencerboucher.com/theme/css/typogrify.css" rel="stylesheet">
    <link rel="stylesheet" href="http://spencerboucher.com/theme/css/style.css" type="text/css"/>

        <link href="http://spencerboucher.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="justmytwospence ATOM Feed"/>

<!-- MathJax script -->
<script src="https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
<script type="text/javascript">
    init_mathjax = function() {
        if (window.MathJax) {
        // MathJax loaded
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
            },
            displayAlign: 'center', // Change this to 'center' to center equations.
            "HTML-CSS": {
                styles: {'.MathJax_Display': {"margin": 0}}
            }
        });
        MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
    }
}
init_mathjax();
</script>
    <link rel="stylesheet" href="/theme/css/knitr.css" type="text/css"/>
    <script src="http://spencerboucher.com/theme/js/knitr.js" type="text/javascript"></script> 

    <link rel="stylesheet" href="http://spencerboucher.com/theme/css/ipythonnb.css" type="test/css"/>


</head>

<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://spencerboucher.com/" class="navbar-brand">
justmytwospence            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="http://spencerboucher.com/pages/about.html">
                             About
                          </a></li>
                         <li><a href="http://spencerboucher.com/pages/map.html">
                             <i class="fa fa-location-arrow fa-lg"></i>
                          </a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                    <li><a href="http://github.com/justmytwospence">
                        <i class="fa fa-github-square fa-lg"></i><span class="icon-label">GitHub</span>
                    </a></li>
                    <li><a href="http://linkedin.com/in/spencerboucher">
                        <i class="fa fa-linkedin-square fa-lg"></i><span class="icon-label">LinkedIn</span>
                    </a></li>
                    <li><a href="feeds/all.atom.xml">
                        <i class="fa fa-rss-square fa-lg"></i><span class="icon-label">RSS</span>
                    </a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
        <div class="col-sm-9">
    

        <section id="content">
            <article>
                <header class="page-header">
                    <h1>Live&nbsp;mapping</h1>
<footer class="post-info">
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2014-01-08T08:50:00"> Wed 08 January 2014</time>
    </span>


    <span>
        <i class="fa fa-folder-open"></i>
        <a href="http://spencerboucher.com/category/vizualization.html">Vizualization</a>
    </span>


	<span>
	<i class="fa fa-tag"></i>
		<a href="http://spencerboucher.com/tag/api.html">api</a>
	        /
		<a href="http://spencerboucher.com/tag/aws.html">aws</a>
	        /
		<a href="http://spencerboucher.com/tag/cartodb.html">cartoDB</a>
	        /
		<a href="http://spencerboucher.com/tag/cartography.html">cartography</a>
	        /
		<a href="http://spencerboucher.com/tag/cron.html">cron</a>
	        /
		<a href="http://spencerboucher.com/tag/ec2.html">ec2</a>
	        /
		<a href="http://spencerboucher.com/tag/map.html">map</a>
	        /
		<a href="http://spencerboucher.com/tag/quantifiedself.html">quantifiedSelf</a>

    
</footer><!-- /.post-info -->                </header>
                <div class="entry-content">
                    <p>I&#8217;ve been wanting to do some more mapping stuff since my first encounter with Leaflet a month or two ago while I was working on a project for <a href="http://auto-grid.com">AutoGrid</a>. I had my eye on CartoDB&#8217;s time series library, <a href="https://github.com/cartodb/torque">Torque</a>, because I had really wanted to do some time-series visualization, but time constraints and privacy issues with uploading data to CartoDB&#8217;s servers prevented me from really exploring. Since I had a few days of free time over winter break, I played around with it a bit and came up with this: <a href="http://www.spencerboucher.com/map">spencerboucher.com/map</a>. How&#8217;d I do&nbsp;it?  </p>
<p>First I needed some geographic data, so I turned to a source of data I&#8217;ve been collected for almost a year - my own location. <a href="http://openpaths.cc">OpenPaths</a> is a mobile app that records your location at regular time intervals. I opted for every 30 minutes at first, then upped it to every 15 minutes when I discovered that the effect on battery life wasn&#8217;t nearly as bad as I expected it to be. OpenPaths is a project of <a href="http://nytlabs.com/">the R&amp;D department at The New York Times</a> and they <a href="https://openpaths.cc/FAQ">claim</a> that you are the only one with access to the collected data. Interestingly, you can grant various <a href="https://openpaths.cc/projects">research programs</a> access to your data at your own discretion. Your data is conveniently downloadable as a csv, json, or kml file, so I easily pulled my dataset of \~3,000 time points since December 2012. Unfortunately, I made the switch from iPhone to Android around April (well, that part is fortunate), and forgot to re-download the app, so I only really have data from the around the first three months and last two months of&nbsp;2013.  </p>
<p>Turns out, making impressive maps with CartoDB is almost embarrassingly easy. Their <span class="caps">GUI</span> is pretty intuitive and running queries on their postgreSQL database is simple. Even time series stuff built on the Torque backend is really just point and click. I decided that the best way to visualize this data was with an aggregated hexbin heatmap of all my past locations, overlaid with a point-by-point replay with a time-slider. From there, it was just a one-line <span class="caps">API</span> call to host the map on my website (line 30 highlighted below), which is significantly easier than the legwork that went into crafting a Leaflet map&nbsp;&#8220;manually.&#8221;</p>
<div class="highlight"><pre><span class="nt">&lt;html&gt;</span>

<span class="nt">&lt;head&gt;</span>

  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;initial-scale=1.0, user-scalable=no&quot;</span> <span class="nt">/&gt;</span>

  <span class="nt">&lt;title&gt;</span>Location | Spencer<span class="nt">&lt;/title&gt;</span>

  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;shortcut icon&quot;</span> <span class="na">href=</span><span class="s">&quot;http://spencerboucher.com/map/favicon.png&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.css&quot;</span> <span class="nt">/&gt;</span>
  <span class="c">&lt;!--[if lte IE 8]&gt;</span>
<span class="c">    &lt;link rel=&quot;stylesheet&quot; href=&quot;http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.ie.css&quot; /&gt;</span>
<span class="c">  &lt;![endif]--&gt;</span>

  <span class="nt">&lt;style </span><span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="nt">&gt;</span>
      <span class="nt">html</span><span class="o">,</span> <span class="nt">body</span><span class="o">,</span> <span class="nf">#map</span> <span class="p">{</span>
          <span class="k">margin</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
          <span class="k">padding</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
          <span class="k">width</span><span class="o">:</span> <span class="m">100</span><span class="o">%</span><span class="p">;</span>
          <span class="k">height</span><span class="o">:</span> <span class="m">100</span><span class="o">%</span><span class="p">;</span>
          <span class="k">background</span><span class="o">:</span> <span class="nb">black</span><span class="p">;</span> <span class="p">}</span>
      <span class="nf">#cartodb-gmaps-attribution</span> <span class="p">{</span>
        <span class="k">visibility</span><span class="o">:</span> <span class="k">hidden</span><span class="p">;</span> <span class="p">}</span>
  <span class="nt">&lt;/style&gt;</span>

  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;http://maps.google.com/maps/api/js?v=3.2&amp;sensor=false&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;http://libs.cartocdn.com/cartodb.js/v3/cartodb.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script&gt;</span>
    <span class="kd">function</span> <span class="nx">init</span><span class="p">(){</span>
      <span class="nx">cartodb</span><span class="p">.</span><span class="nx">createVis</span><span class="p">(</span><span class="s1">&#39;map&#39;</span><span class="p">,</span> <span class="s1">&#39;http://justmytwospence.cartodb.com/api/v2/viz/e8fd87d0-78b3-11e3-a9e9-e7941b6e2df0/viz.json&#39;</span><span class="p">);</span> <span class="p">}</span>
  <span class="nt">&lt;/script&gt;</span>

<span class="nt">&lt;/head&gt;</span>

<span class="nt">&lt;body</span> <span class="na">onload=</span><span class="s">&quot;init()&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&#39;map&#39;</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>
</pre></div>


<p>This is pretty awesome, but in light of how easy it all was, I was almost disappointed. Can we take it one step further? Let&#8217;s put on our <a href="http://quantifiedself.com/about/">Quantified Self</a> hats and set about to make this map <em>live</em>. There&#8217;s three components to making this happen, so we&#8217;ll step through them one at a time. First we need to access the most recent data from OpenPaths (there&#8217;s an <span class="caps">API</span> for that!), and then we need to insert that data into CartoDB&#8217;s database (guess what, there&#8217;s an <span class="caps">API</span> for that too). Last but not least, we need to schedule that data transplant to occur on a regular basis. The Unix utility <code>cron</code> is the canonical tool for this type of thing, so this seemed like a good time to learn how to use&nbsp;it.  </p>
<p>Python has a reputation for being a great &#8220;glue&#8221; language, so that&#8217;s what we&#8217;ll use to build this&nbsp;script.  </p>
<p>Programmatically accessing your data from OpenPaths is super simple. This piece of our script is pulled more or less verbatim from <a href="https://openpaths.cc/api">the OpenPaths <span class="caps">API</span> documentation</a>. Line 21 (highlighted below) is key - this is where we specify which data you want to pull for injection into the CartoDB database. Here we will grab the last 24 hours of data (\~96 readings, if you&#8217;re collecting every 15 minutes like me), getting the results in a nice  <span class="caps">JSON</span>-formatted variable named <code>data</code>.</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">oauth2</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">urllib</span><span class="o">,</span> <span class="nn">urllib2</span><span class="o">,</span> <span class="nn">json</span>

<span class="n">ACCESS</span> <span class="o">=</span> <span class="s">&#39;redacted&#39;</span>
<span class="n">SECRET</span> <span class="o">=</span> <span class="s">&#39;redacted&#39;</span>
<span class="n">URL</span> <span class="o">=</span> <span class="s">&#39;https://openpaths.cc/api/1&#39;</span>

<span class="k">def</span> <span class="nf">build_auth_header</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;oauth_version&#39;</span><span class="p">:</span> <span class="s">&quot;1.0&quot;</span><span class="p">,</span>
        <span class="s">&#39;oauth_nonce&#39;</span><span class="p">:</span> <span class="n">oauth2</span><span class="o">.</span><span class="n">generate_nonce</span><span class="p">(),</span>
        <span class="s">&#39;oauth_timestamp&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
    <span class="p">}</span>
    <span class="n">consumer</span> <span class="o">=</span> <span class="n">oauth2</span><span class="o">.</span><span class="n">Consumer</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">ACCESS</span><span class="p">,</span> <span class="n">secret</span><span class="o">=</span><span class="n">SECRET</span><span class="p">)</span>
    <span class="n">params</span><span class="p">[</span><span class="s">&#39;oauth_consumer_key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">consumer</span><span class="o">.</span><span class="n">key</span> 
    <span class="n">request</span> <span class="o">=</span> <span class="n">oauth2</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
    <span class="n">signature_method</span> <span class="o">=</span> <span class="n">oauth2</span><span class="o">.</span><span class="n">SignatureMethod_HMAC_SHA1</span><span class="p">()</span>
    <span class="n">request</span><span class="o">.</span><span class="n">sign_request</span><span class="p">(</span><span class="n">signature_method</span><span class="p">,</span> <span class="n">consumer</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">to_header</span><span class="p">()</span>

<span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;start_time&#39;</span><span class="p">:</span> <span class="n">now</span> <span class="o">-</span> <span class="mi">24</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span> <span class="s">&#39;end_time&#39;</span><span class="p">:</span> <span class="n">now</span><span class="p">}</span> <span class="c"># get the last 24 hours</span>
<span class="n">query</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">?</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">URL</span><span class="p">,</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">params</span><span class="p">))</span>
<span class="c">#print(query)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="n">request</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="n">build_auth_header</span><span class="p">(</span><span class="n">URL</span><span class="p">,</span> <span class="s">&#39;GET&#39;</span><span class="p">)</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">readlines</span><span class="p">()))</span>
    <span class="k">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
<span class="k">except</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>


<p>Now we need to get our new <code>data</code> variable into CartoDB&#8217;s postgreSQL server. <a href="http://developers.cartodb.com/documentation/sql-api.html">CartoDB&#8217;s <span class="caps">SQL</span> <span class="caps">API</span> documentation</a> makes this possible, and there&#8217;s even a <a href="https://github.com/vizzuality/cartodb-python">python module</a> that wraps OAuth2 to simplify things. Although its still in the early stages of development, this module works fine for our current purposes; all we have to do is send it a string that holds the <span class="caps">SQL</span> query we want to run. So now we&#8217;ll just write a for-loop that successively builds an <code>INSERT</code> query for each element in <code>data</code> (lines 18-20 highlighted&nbsp;below).</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">cartodb</span> <span class="kn">import</span> <span class="n">CartoDBException</span><span class="p">,</span> <span class="n">CartoDBAPIKey</span>

<span class="n">user</span> <span class="o">=</span>  <span class="s">&#39;spencer.g.boucher@gmail.com&#39;</span>
<span class="n">password</span> <span class="o">=</span>  <span class="s">&#39;redacted&#39;</span>
<span class="n">cartodb_domain</span> <span class="o">=</span> <span class="s">&#39;justmytwospence&#39;</span>
<span class="n">API_KEY</span> <span class="o">=</span><span class="s">&#39;redacted&#39;</span>
<span class="n">cl</span> <span class="o">=</span> <span class="n">CartoDBAPIKey</span><span class="p">(</span><span class="n">API_KEY</span><span class="p">,</span> <span class="n">cartodb_domain</span><span class="p">)</span>

<span class="k">for</span> <span class="n">reading</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">alt</span>     <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">reading</span><span class="p">[</span><span class="s">&#39;alt&#39;</span><span class="p">])</span>
    <span class="n">device</span>  <span class="o">=</span>     <span class="n">reading</span><span class="p">[</span><span class="s">&#39;device&#39;</span><span class="p">]</span>
    <span class="n">lat</span>     <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">reading</span><span class="p">[</span><span class="s">&#39;lat&#39;</span><span class="p">])</span>
    <span class="n">lon</span>     <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">reading</span><span class="p">[</span><span class="s">&#39;lon&#39;</span><span class="p">])</span>
    <span class="n">os</span>      <span class="o">=</span>     <span class="n">reading</span><span class="p">[</span><span class="s">&#39;os&#39;</span><span class="p">]</span>
    <span class="n">t</span>       <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">reading</span><span class="p">[</span><span class="s">&#39;t&#39;</span><span class="p">])</span>
    <span class="n">version</span> <span class="o">=</span>     <span class="n">reading</span><span class="p">[</span><span class="s">&#39;version&#39;</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">query_string</span> <span class="o">=</span> <span class="s">&quot;INSERT INTO openpaths_justmytwospence (alt, date, device, lat,  lon, os, version, the_geom) &quot;</span>
                       <span class="s">&quot;VALUES ({0}, abstime({1}), &#39;{2}&#39;, {3}, {4}, &#39;{5}&#39;, &#39;{6}&#39;, ST_ SetSRID(ST_Point({4}, {3}), 4326))&quot;</span>
                      <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">alt</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">cl</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">query_string</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">CartoDBException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="p">(</span><span class="s">&quot;some error ocurred&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</pre></div>


<p>A few&nbsp;notes:</p>
<ul>
<li>It would certainly be faster to insert all of the new data into the
    database using a single <code>INSERT</code> statement, but that would require
    some more tedious text parsing and execution speed isn&#8217;t
    particularly important to us. As it stands, it takes about six
    seconds to post a day&#8217;s worth of&nbsp;data.</li>
<li>One posgreSQL &#8220;gotcha&#8221; had me hung up for quite some time: single
    quotes parse fine but double quotes do&nbsp;not.</li>
<li><code>ST_SetSRID</code> is a <a href="http://postgis.org/docs/ST_SetSRID.html">PostGIS command</a> that converts a lon/lat pair
    (in that order - another &#8220;gotcha&#8221;) to the necessary geometry&nbsp;object.  </li>
</ul>
<p>Last but not least, we need this script to run automatically. Because we&#8217;ve written the script to transplant 24 hours of data, we&#8217;ll need to run it once a day in order to capture all of the data that&#8217;s being generated. I tried to set up my web host, <a href="https://laughingsquid.us/">LaughingSquid</a>, to do this, but unfortunately they don&#8217;t grant shell access so we can&#8217;t install all those fancy python modules that we&#8217;ve already used. Its totally possible to rewrite the script to use only modules from the <a href="http://docs.python.org/2/library/">Python Standard Library</a>, but this would turn a simple task into a tedious one. Manually implementing OAuth in particular would be a total pain in the rear, and classes are just about to resume after all, so a different solution is in order. Let&#8217;s spin up a <a href="http://aws.amazon.com/">&#8220;micro&#8221; <span class="caps">EC2</span> instance</a> instead. This gives us free reign to install whatever we need for the low low cost of ¢.02 per hour. This does start to add up, but our Master&#8217;s program gives us some pretty substantial Amazon Web Services credit that goes mostly unused, so we aren&#8217;t too upset :). <span class="caps">UPDATE</span>: A new post provides details about how to schedule Amazon <span class="caps">EC2</span> instances - <a href="http://www.spencerboucher.com/ec2-apis/">http://www.spencerboucher.com/ec2-apis/</a>.  </p>
<p>After <code>pip install</code>ing everything we need and <code>scp</code>ing our python script (let&#8217;s call it update.py) into the home directory of our remote server, all we need to do is set up a crontab with the <code>crontab -e</code> command and add the following&nbsp;line:</p>
<div class="highlight"><pre>@daily /usr/bin/python ~/update.py
</pre></div>


<p><code>@daily</code> is actually a shortcut for <code>* * * * *</code>, where each asterix is a
placeholder for the (respectively) minute, hour, day of month, month,
and day of week that the script should executed. This shortcut defaults
to midnight every day, which is really as good as anything for our&nbsp;purposes.  </p>
<p>Voilà! Now we can step back and relax, knowing that we don&#8217;t have to do a single thing and our map will continue to show the most up-to-date data&nbsp;available.  </p>
<p>A few final&nbsp;notes:</p>
<ul>
<li>We might reasonably want to lag our script by a week or so, for security/privacy&nbsp;reasons.</li>
<li>As far as I can tell, the location readings are recorded in a <a href="http://en.wikipedia.org/wiki/Unix_time"><span class="caps">POSIX</span> time</a> and have not been adjusted by time zone, so they are still in the <a href="http://en.wikipedia.org/wiki/Coordinated_Universal_Time"><span class="caps">UTC</span></a> time zone. This means that they are 8 hours off from the actual time in California, where I usually am. This doesn&#8217;t bother me too much at the moment because the visualization is still relatively low resolution in the time domain anyways. At some point I might implement the relevant transformation, but this will raise its own issues because I won&#8217;t <em>always</em> be in California, not to mention all that Daylight Savings&nbsp;nonsense.</li>
<li><a href="http://www.spencerboucher.com/ec2-apis/">Click here for an addendum to this post that will take you through how to schedule the <span class="caps">EC2</span> instance and avoid having it run&nbsp;24/7</a></li>
</ul>
                </div>
                <!-- /.entry-content -->
    <hr />
    <section class="comments" id="comments">
        <h2>Comments</h2>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'justmytwospence'; // required: replace example with your forum shortname
            var disqus_identifier = 'live-mapping';
            var disqus_url = 'http://spencerboucher.com/live-mapping.html';
            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
            </article>
        </section>
    </div>


<div class="col-sm-3" id="sidebar">

        <div style="text-align: center; margin: 20px auto;">
            <div class="btn-group btn-group-lg text-center">
                    <a type="button" class="btn btn-primary" href="http://spencerboucher.com/map-time-at-stamen.html">Previous</a>
                    <a type="button" class="btn btn-primary" href="http://spencerboucher.com/stratified-sampling-in-r.html">Next</a>
            </div>
        </div>


    <section class="panel panel-default text-center">
        <div class="panel-heading">
            <a href="http://spencerboucher.com/categories">
                <h4 class="panel-title">
                    <i class="fa fa-folder-open fa-lg"></i>
                    <span class="icon-label">Categories</span>
                </h4>
            </a>
        </div>
        <div class="list-group" id="categories">
                <a class="Design list-group-item " href="http://spencerboucher.com/category/design.html">
                    <h4>Design</h4>
                </a>
                <a class="Misc list-group-item " href="http://spencerboucher.com/category/misc.html">
                    <h4>Misc</h4>
                </a>
                <a class="Python list-group-item " href="http://spencerboucher.com/category/python.html">
                    <h4>Python</h4>
                </a>
                <a class="R list-group-item " href="http://spencerboucher.com/category/r.html">
                    <h4>R</h4>
                </a>
                <a class="Vizualization list-group-item active" href="http://spencerboucher.com/category/vizualization.html">
                    <h4>Vizualization</h4>
                </a>
        </div>
    </section>

        <section class = "panel panel-default text-center">
            <div class="panel-heading">
                <a href="http://spencerboucher.com/tags">
                    <h4 class=  "panel-title">
                        <i class="fa fa-tags fa-lg"></i>
                        <span class="icon-label">Tags</span>
                    </h4>
                </a>
            </div>
            <div class="list-group list-inline tagcloud" id="tags">
                    <li class="list-group-item">
                        <a class="tag-3" href="http://spencerboucher.com/tag/api.html">
                            api
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-3" href="http://spencerboucher.com/tag/aws.html">
                            aws
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-3" href="http://spencerboucher.com/tag/brain.html">
                            brain
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-5" href="http://spencerboucher.com/tag/cartodb.html">
                            cartoDB
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-3" href="http://spencerboucher.com/tag/cartography.html">
                            cartography
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-5" href="http://spencerboucher.com/tag/coursera.html">
                            Coursera
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-3" href="http://spencerboucher.com/tag/cron.html">
                            cron
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-5" href="http://spencerboucher.com/tag/crowdsourcing.html">
                            crowdsourcing
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-5" href="http://spencerboucher.com/tag/design.html">
                            design
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-3" href="http://spencerboucher.com/tag/ec2.html">
                            ec2
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-5" href="http://spencerboucher.com/tag/economics.html">
                            economics
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-1" href="http://spencerboucher.com/tag/education.html">
                            education
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-5" href="http://spencerboucher.com/tag/freakonomics.html">
                            freakonomics
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-5" href="http://spencerboucher.com/tag/freesurfer.html">
                            Freesurfer
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-5" href="http://spencerboucher.com/tag/ggplot2.html">
                            ggplot2
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-5" href="http://spencerboucher.com/tag/hierarchy-of-needs.html">
                            Hierarchy of needs
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-5" href="http://spencerboucher.com/tag/higher-education.html">
                            higher education
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-5" href="http://spencerboucher.com/tag/ideas-worth-spreading.html">
                            ideas worth spreading
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-3" href="http://spencerboucher.com/tag/machine-learning.html">
                            machine learning
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-5" href="http://spencerboucher.com/tag/mooc.html">
                            MOOC
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-1" href="http://spencerboucher.com/tag/neuroscience.html">
                            neuroscience
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-5" href="http://spencerboucher.com/tag/pelican.html">
                            pelican
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-5" href="http://spencerboucher.com/tag/politics.html">
                            politics
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-5" href="http://spencerboucher.com/tag/prediction.html">
                            prediction
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-5" href="http://spencerboucher.com/tag/predictions.html">
                            predictions
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-1" href="http://spencerboucher.com/tag/r.html">
                            R
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-1" href="http://spencerboucher.com/tag/shiny.html">
                            shiny
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-3" href="http://spencerboucher.com/tag/stepwise.html">
                            stepwise
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-5" href="http://spencerboucher.com/tag/ted.html">
                            TED
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a class="tag-5" href="http://spencerboucher.com/tag/tex.html">
                            tex
                        </a>
                    </li>
            </div>
        </section>  


	<!-- no header
    <li class="list-group-item"><h4><i class="fa fa-twitter fa-lg"></i><span class="icon-label">Latest Tweets</span></h4></li>
    -->

    <div id="twitter_timeline">
        <a class="twitter-timeline" data-chrome="noheader" href="https://twitter.com/justmytwospence" data-widget-id="413946059455361024">Tweets by justmytwospence</a>
    </div>

<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

</div>
    </div>
</div>

<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2014 Spencer Boucher
            &middot; Powered by <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>, <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>, <a href="http://pages.github.com/" target="_blank">GitHub Pages</a>, and Viewers Like You         </div>
         <div class="col-xs-2"><a href="#" class="pull-right"><i class="fa fa-arrow-circle-up fa-lg"></i></a></div>
      </div>
   </div>
</footer>
<script src="http://code.jquery.com/jquery.js"></script>

<script src="http://spencerboucher.com/theme/js/dynamic.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://spencerboucher.com/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://spencerboucher.com/theme/js/respond.min.js"></script>

    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'justmytwospence'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-45101202-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();

    </script>


</body>

</html>